<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Benedis Lifescience — Dashboard</title>

  <!-- Bootstrap 4 -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Dashboard styles (namespaced) -->
  <link rel="stylesheet" href="assets/css/dashboard.css">
</head>

<body>
  <div id="benedis-dashboard">
    <div class="d-flex" id="wrapper">

      <!-- Sidebar -->
      <nav id="sidebar" class="bg-white border-right">
        <div class="sidebar-sticky p-3">
          <div class="text-center mb-3">
            <div class="avatar-wrapper mb-2">
              <!-- replace src below with your uploaded image if needed -->
              <img src="assets/images/doctor-profile-img.jpg" alt="avatar" class="avatar-img">
            </div>
            <h6 class="mb-0 font-weight-bold">Mr. Mohan Sharma</h6>
            <div class="role-badge mt-2">BE - Business Executives</div>
          </div>

          <ul class="nav flex-column sidebar-nav">
            <li class="nav-item">
              <a class="nav-link active" href="dashboard.html"><i class="fa-solid fa-table mr-2"></i> Dashboard</a>
            </li>

            <li class="nav-item">
              <a class="nav-link collapsed" href="#appointmentsSub" data-toggle="collapse" aria-expanded="false">
                <i class="fa-regular fa-calendar-check mr-2"></i> Tour Plan <i
                  class="fa fa-chevron-down float-right"></i>
              </a>
              <div id="appointmentsSub" class="collapse">
                <ul class="sub-nav">
                  <li><a href="add-tour-planner.html">Add Tour Plan</a></li>
                  <li><a href="view-tour-planner.html">View All Tour Plans</a></li>
                  <li><a href="add-dcr-report.html">Submit DCR Report</a></li>
                </ul>
              </div>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="appointment_list.html"><i class="fa-solid fa-list mr-2"></i> View All Appointments</a>
            </li>

            <!-- <li class="nav-item">
              <a class="nav-link collapsed" href="#doctorsSub" data-toggle="collapse" aria-expanded="false">
                <i class="fa-solid fa-user-doctor mr-2"></i> Doctors <i class="fa fa-chevron-down float-right"></i>
              </a>
              <div id="doctorsSub" class="collapse">
                <ul class="sub-nav">
                  <li><a href="#">All Doctors</a></li>
                  <li><a href="#">Add Doctor</a></li>
                </ul>
              </div>
            </li>

            <li class="nav-item">
              <a class="nav-link collapsed" href="#reportingSub" data-toggle="collapse" aria-expanded="false">
                <i class="fa-solid fa-triangle-exclamation mr-2"></i> False Reporting <i
                  class="fa fa-chevron-down float-right"></i>
              </a>
              <div id="reportingSub" class="collapse">
                <ul class="sub-nav">
                  <li><a href="#">List</a></li>
                </ul>
              </div>
            </li>

            <li class="nav-item">
              <a class="nav-link collapsed" href="#leaveSub" data-toggle="collapse" aria-expanded="false">
                <i class="fa-regular fa-clock mr-2"></i> Apply Leave <i class="fa fa-chevron-down float-right"></i>
              </a>
              <div id="leaveSub" class="collapse">
                <ul class="sub-nav">
                  <li><a href="#">Apply</a></li>
                  <li><a href="#">My Leaves</a></li>
                </ul>
              </div>
            </li>

            <li class="nav-item">
              <a class="nav-link collapsed" href="#expenseSub" data-toggle="collapse" aria-expanded="false">
                <i class="fa-solid fa-wallet mr-2"></i> Expense <i class="fa fa-chevron-down float-right"></i>
              </a>
              <div id="expenseSub" class="collapse">
                <ul class="sub-nav">
                  <li><a href="#">Add Expense</a></li>
                  <li><a href="#">Expense List</a></li>
                </ul>
              </div>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="#"><i class="fa-solid fa-calendar-day mr-2"></i> Holidays</a>
            </li> -->
          </ul>
        </div>
      </nav>
      <!-- /#sidebar -->

      <!-- Page Content -->
      <div id="page-content-wrapper" class="w-100">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white border-bottom topbar">
          <button class="btn btn-link" id="menu-toggle"><i class="fa fa-bars"></i></button>

          <div class="navbar-brand ml-2">Benedis Lifescience</div>

          <ul class="navbar-nav ml-auto align-items-center">
            <li class="nav-item mr-3 d-none d-md-block">
              <a class="nav-link small text-muted" href="#"><i class="fa-solid fa-house mr-2"></i>
                Dashboard</a>
            </li>

            <li class="nav-item mr-3">
              <a class="nav-link" href="#"><i class="fa-regular fa-bell"></i></a>
            </li>
            <li class="nav-item dropdown profile-dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="profileMenu" role="button" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                <i class="fa-regular fa-user"></i>
              </a>

              <div class="dropdown-menu dropdown-menu-right shadow-sm" aria-labelledby="profileMenu">
                <a class="dropdown-item" href="#">
                  <i class="fa-regular fa-id-badge mr-2"></i> Profile
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item text-danger font-weight-bold" href="index.html">
                  <i class="fa-solid fa-right-from-bracket mr-2"></i> Logout
                </a>
              </div>
            </li>

          </ul>
        </nav>

        <!-- Main container -->
        <div class="container-fluid main-container p-4">
          <!-- Breadcrumb / header -->
          <div class="d-flex align-items-center mb-3">
            <nav aria-label="breadcrumb" class="w-100">
              <ol class="breadcrumb mb-0 bg-transparent p-0">
                <li class="breadcrumb-item "><i class="fa-solid fa-house align-content-center"></i></li>
                <li class="breadcrumb-item active">Add Tour Plan</li>
              </ol>
            </nav>
          </div>

          <!-- START: Enhanced Tour Plan Module (Start & End Date) -->
          <div id="benedis-dashboard-tour" class="w-100">
            <div class="row">

              <!-- Left Side: Form -->
              <div class="col-md-7">
                <div class="tour-panel p-3">

                  <!-- Row 1 : Plan Month -->
                  <div class="form-row">
                    <div class="form-group col-md-4">
                      <label class="font-weight-600">Select Plan Month*</label>
                      <input type="month" id="planMonthYear" class="form-control form-control-sm">
                    </div>
                  </div>

                  <!-- Row 2 : Visit Time + Select Doctors -->
                  <div class="form-row">

                    <!-- Select Doctors / Chemists -->
                    <!-- Select Doctors / Chemists -->
                    <div class="form-group col-md-8">
                      <label class="font-weight-600">Select Doctors / Chemists*</label>

                      <select id="doctorSelect" class="form-control form-control-sm h-75" multiple>
                        <!-- Filled by JS -->
                      </select>

                      <small class="text-muted">
                        Selected: <span id="doctorCount">0</span> / 15
                      </small>
                    </div>


                    <!-- Visit Time -->
                    <div class="form-group col-md-4">
                      <label class="font-weight-600">Visit Time*</label>
                      <select id="visitTime" class="form-control form-control-sm">
                        <option>Morning</option>
                        <option>Evening</option>
                      </select>
                    </div>



                  </div>

                  <!-- Row 3 : Remarks -->
                  <div class="form-group">
                    <label class="font-weight-600">Consolidated Remarks*</label>
                    <textarea id="consolidatedRemarks" class="form-control form-control-sm" rows="3"
                      placeholder="Add consolidated remarks for the plan"></textarea>
                  </div>

                  <!-- Note Section -->
                  <div class="alert alert-info small mt-2">
                    <strong>Note:</strong><br>
                    • Maximum doctors allowed per plan: <strong>15</strong><br>
                    • Total assigned doctors/chemists for this BE: <strong>120</strong>
                  </div>

                  <!-- Hidden fields preserved -->
                  <input id="visitsPerDay" type="hidden" value="15" />
                  <input id="totalAssigned" type="hidden" value="120" />

                  <!-- Submit / Reset -->
                  <div class="d-flex justify-content-end" style="gap:8px;">
                    <button id="tourReset" class="btn btn-outline-secondary btn-sm">Reset</button>
                    <button id="addTour" class="btn btn-success btn-sm">Add Tour</button>

                  </div>

                  <div class="d-flex justify-content-end mt-3" style="gap:8px;">
                    <button id="submitMonth" class="btn btn-primary btn-sm">Submit Tour Plan For Month</button>
                  </div>

                </div>
              </div>

              <!-- Right Side: Tours & Selected Doctors area -->
              <div class="col-md-5">
                <div class="selected-panel p-3">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="font-weight-600">
                      Added Tours – <strong id="tourCount">0</strong>
                    </div>
                    <button id="clearAllTours" class="btn btn-sm btn-link">Clear All</button>
                  </div>

                  <!-- list of tours (cards) -->
                  <div id="toursList" class="p-2"></div>

                  <hr />

                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="font-weight-600">
                      Selected Doctors – <strong id="selCount">0</strong>
                    </div>
                    <button id="clearSelected" class="btn btn-sm btn-link">Clear</button>
                  </div>

                  <div class="selected-list p-2" id="selectedList">
                    <div class="text-muted">No doctors selected yet.</div>
                  </div>
                </div>

              </div>
            </div>


            <!-- END: Enhanced Tour Plan Module -->




            <!-- Empty content area (placeholder) -->
            <div class="content-area mt-4">
              <!-- Put charts / tables here -->
            </div>

            <!-- Footer -->
            <footer class="footer mt-5 py-3 text-center text-muted">
              © <span id="year"></span> Benedis Lifescience — All Rights Reserved
            </footer>
          </div>
          <!-- /Main container -->
        </div>
        <!-- /#page-content-wrapper -->

      </div>
      <!-- /#wrapper -->
    </div>

    <!-- JS (Bootstrap 4) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
      // set current year in footer
      document.getElementById('year').textContent = new Date().getFullYear();

      // Sidebar toggle (scoped to benedis-dashboard)
      (function () {
        var $menuToggle = document.querySelector('#benedis-dashboard #menu-toggle');
        var $sidebar = document.querySelector('#benedis-dashboard #sidebar');
        var $page = document.querySelector('#benedis-dashboard #page-content-wrapper');

        $menuToggle.addEventListener('click', function (e) {
          e.preventDefault();
          $sidebar.classList.toggle('collapsed');
          $page.classList.toggle('expanded');
        });
      })();


    </script>




    <script>
      $(function () {

        // CONFIG
        const maxDoctors = parseInt($('#visitsPerDay').val() || 15, 10); // 15 by default
        const totalAssigned = parseInt($('#totalAssigned').val() || 120, 10);

        // SAMPLE DATA (replace with real data or fetch via AJAX)
        const sampleDoctors = [
          { id: "1",  name: "Dr. Arvind Sharma",        meta: "Cardiologist" },
          { id: "2",  name: "Dr. Bhavna Verma",         meta: "Dermatologist" },
          { id: "3",  name: "Dr. Chirag Singh",         meta: "General Physician" },
          { id: "4",  name: "Dr. Deepak Rao",           meta: "Orthopedic Surgeon" },
          { id: "5",  name: "Dr. Esha Nair",            meta: "General Physician" },
          { id: "6",  name: "Dr. Farhan Patel",         meta: "ENT Specialist" },
          { id: "7",  name: "Dr. Gopal Iyer",           meta: "Pediatrician" },
          { id: "8",  name: "Dr. Hamid Khan",           meta: "Neurologist" },
          { id: "9",  name: "Dr. Ishita Das",           meta: "Psychiatrist" },
          { id: "10", name: "Dr. Jatin Gupta",          meta: "Endocrinologist" },
          { id: "11", name: "Dr. Kavita Sinha",         meta: "Gynecologist" },
          { id: "12", name: "Dr. Lakshay Mehta",        meta: "Urologist" },
          { id: "13", name: "Dr. Manish Chaturvedi",    meta: "Gastroenterologist" },
          { id: "14", name: "Dr. Neha Kulkarni",        meta: "Ophthalmologist" },
          { id: "15", name: "Dr. Omprakash Yadav",      meta: "General Surgeon" },
          { id: "16", name: "Dr. Priya Deshmukh",       meta: "Radiologist" },
          { id: "17", name: "Dr. Quresh Ahmed",         meta: "Nephrologist" },
          { id: "18", name: "Dr. Ritu Jain",            meta: "Dentist" },
          { id: "19", name: "Dr. Siddharth Bose",       meta: "Oncologist" },
          { id: "20", name: "Dr. Tanvi Raghavan",       meta: "Rheumatologist" }
        ];


        // init page
        $('#year').text(new Date().getFullYear());

        // Populate doctor dropdown
        function loadDoctorDropdown() {
          const $dd = $("#doctorSelect");
          $dd.empty();
          sampleDoctors.forEach(doc => {
            $dd.append(`<option value="${doc.id}">${doc.name} (${doc.meta})</option>`);
          });
        }
        loadDoctorDropdown();

        // Utility: get selected ids (array of strings)
        function getSelectedIds() {
          return $("#doctorSelect").val() || [];
        }

        // Update counters & right panel
        function updateCountsAndPanel() {
          const selected = getSelectedIds();
          const count = selected.length;
          $("#doctorCount").text(count);
          $("#selCount").text(count);
          renderSelectedList(selected);
        }

        // Render Right Side Selected List
        function renderSelectedList(selectedIds) {
          const $box = $("#selectedList");
          $box.empty();

          if (!selectedIds || selectedIds.length === 0) {
            $box.html(`<div class="text-muted">No doctors selected yet.</div>`);
            return;
          }

          selectedIds.forEach(id => {
            const doc = sampleDoctors.find(d => d.id === id);
            if (!doc) return;
            const $item = $(`
        <div class="border rounded p-2 mb-1 small doctor-pill" data-id="${doc.id}">
          <div>
            <strong>${doc.name}</strong><br>
            <span class="text-muted">${doc.meta}</span>
          </div>
          <div>
            <span class="remove-doc text-danger" title="Remove">&times;</span>
          </div>
        </div>
      `);
            $box.append($item);
          });
        }

        // When dropdown changes: enforce max and update UI
        $("#doctorSelect").on("change", function () {
          let selected = $(this).val() || [];

          // Enforce max
          if (selected.length > maxDoctors) {
            // keep first N, remove rest
            alert(`You can select a maximum of ${maxDoctors} doctors per plan.`);
            selected = selected.slice(0, maxDoctors);
            $(this).val(selected);
          }

          updateCountsAndPanel();
        });

        // Click on remove pill -> remove from select
        $("#selectedList").on("click", ".remove-doc", function () {
          const id = $(this).closest('[data-id]').data('id')?.toString();
          if (!id) return;
          let selected = getSelectedIds();
          selected = selected.filter(s => s !== id);
          $("#doctorSelect").val(selected).trigger('change');
        });

        // Add Tour button -> create tour card from current selection
        $("#addTour").on("click", function () {
          const selected = getSelectedIds();
          if (!selected || selected.length === 0) {
            alert("Please select at least one doctor before adding a tour.");
            return;
          }

          // Required fields: plan month & visit time
          const planMonth = $("#planMonthYear").val();
          if (!planMonth) {
            alert("Please select Plan Month.");
            return;
          }
          const visitTime = $("#visitTime").val();
          const remarks = $("#consolidatedRemarks").val() || "";

          // Build tour card
          const tourId = 'tour-' + Date.now();
          const doctorHtml = selected.map(id => {
            const d = sampleDoctors.find(x => x.id === id);
            return d ? `<div><strong>${d.name}</strong> <small class="text-muted">(${d.meta})</small></div>` : '';
          }).join('');

          const card = $(`
      <div class="tour-card" data-tourid="${tourId}">
        <div class="d-flex justify-content-between align-items-start mb-1">
          <div>
            <strong>Plan:</strong> ${formatMonth(planMonth)} <small class="small-muted">• ${visitTime}</small>
          </div>
          <div>
            <button class="btn btn-sm btn-outline-danger remove-tour">Remove</button>
          </div>
        </div>
        <div class="mb-2">${doctorHtml}</div>
        <div class="small text-muted">Remarks: ${escapeHtml(remarks || '—')}</div>
      </div>
    `);

          $("#toursList").prepend(card);

          // Update tour count
          const tcount = $("#toursList .tour-card").length;
          $("#tourCount").text(tcount);

          // Optionally clear selection after adding (comment/uncomment as desired)
          // $("#doctorSelect").val([]).trigger('change');
        });

        // Remove single tour
        $("#toursList").on("click", ".remove-tour", function () {
          $(this).closest('.tour-card').remove();
          const tcount = $("#toursList .tour-card").length;
          $("#tourCount").text(tcount);
        });

        // Reset button -> clears form and selected doctors and remarks
        $("#tourReset").on("click", function (e) {
          e.preventDefault();
          $("#planMonthYear").val('');
          $("#visitTime").val('Morning');
          $("#consolidatedRemarks").val('');
          $("#doctorSelect").val([]).trigger('change');
        });

        // Clear selected doctors (right panel + select)
        $("#clearSelected").on("click", function (e) {
          e.preventDefault();
          $("#doctorSelect").val([]).trigger('change');
        });

        // Clear all tours
        $("#clearAllTours").on("click", function (e) {
          e.preventDefault();
          if (!confirm("Clear all added tours?")) return;
          $("#toursList").empty();
          $("#tourCount").text(0);
        });

        // Submit month -> basic validation sample
        $("#submitMonth").on("click", function () {
          const planMonth = $("#planMonthYear").val();
          if (!planMonth) { alert("Please select Plan Month before submitting."); return; }
          // Example checks or gather tours to submit
          const tours = [];
          $("#toursList .tour-card").each(function () {
            const t = {
              html: $(this).html()
            };
            tours.push(t);
          });

          // For demo show counts
          alert(`Submitting ${tours.length} tour(s) for ${formatMonth(planMonth)}. (Implement AJAX save as needed.)`);
          // TODO: implement AJAX POST to server with collected tour data
        });

        // Helpers
        function formatMonth(monthValue) {
          // monthValue format "YYYY-MM"
          if (!monthValue) return '';
          const [y, m] = monthValue.split('-');
          const dt = new Date(y, parseInt(m, 10) - 1, 1);
          return dt.toLocaleString('default', { month: 'short', year: 'numeric' });
        }

        function escapeHtml(text) {
          return String(text)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');
        }

        // initial UI state
        updateCountsAndPanel();

        // If you want to pre-select some doctors programmatically:
        // $("#doctorSelect").val(["1","3"]).trigger('change');

      });
    </script>




</body>

</html>